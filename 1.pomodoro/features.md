# ポモドーロタイマー 機能仕様書

## 概要
ゲーミフィケーション要素を取り入れたポモドーロタイマーアプリケーションの機能仕様書です。

## 主要機能

### 1. ポモドーロタイマー機能

#### 1.1 タイマー操作
- **開始**: タイマーを開始し、新しいセッションを作成
- **一時停止**: タイマーを一時停止（再開可能）
- **リセット**: タイマーをリセットし、初期状態に戻す
- **時間設定**: 15分、25分、45分から選択可能

#### 1.2 プログレス表示
- **プログレスリング**: 残り時間を視覚的に表示
- **デジタル表示**: MM:SS形式で残り時間を表示
- **完了通知**: タイマー完了時にアラート表示

### 2. ゲーミフィケーション機能

#### 2.1 経験値（XP）システム
- **XP獲得**: ポモドーロ完了ごとにXPを獲得
  - 計算式: `XP = 時間（分）× 2`
  - 例: 25分完了 = 50 XP
- **XPバー表示**: 現在のXPと次のレベルまでの進捗を表示
- **XP情報**: "50 / 100 XP" のような形式で表示

#### 2.2 レベルシステム
- **レベル計算**: `レベル = (XP ÷ 100) + 1`
- **レベルアップ**: 100 XP ごとにレベルアップ
- **レベル表示**: ヘッダーに "Lv. X" の形式で表示
- **レベルアップ通知**: レベルアップ時にモーダル表示

#### 2.3 ストリークシステム
- **連続達成カウント**: 連続してポモドーロを完了した日数
- **ストリーク表示**: 🔥 アイコンと日数を表示
- **最長ストリーク記録**: ユーザーの最長連続記録を保持
- **ルール**:
  - 同日の複数セッションは1日としてカウント
  - 日をまたぐ連続達成でストリークが増加
  - 1日でも欠けるとリセット（将来実装）

#### 2.4 バッジシステム
- **バッジ一覧表示**: 取得済み・未取得バッジを表示
- **バッジ獲得通知**: 新しいバッジ獲得時にモーダル表示
- **バッジの種類**:

| バッジID | 名前 | アイコン | 条件 |
|---------|------|---------|------|
| streak_3 | 3日連続達成 | 🔥 | 3日連続でポモドーロ完了 |
| streak_7 | 1週間連続達成 | ⭐ | 7日連続でポモドーロ完了 |
| weekly_10 | 今週10回完了 | 🎯 | 今週10回のポモドーロ完了 |
| weekly_20 | 今週20回完了 | 💎 | 今週20回のポモドーロ完了 |
| total_50 | 合計50回完了 | 🏆 | 累計50回のポモドーロ完了 |
| total_100 | 合計100回完了 | 👑 | 累計100回のポモドーロ完了 |

### 3. 統計機能

#### 3.1 基本統計
- **今週の完了**: 今週完了したセッション数
- **今月の完了**: 今月完了したセッション数
- **総完了数**: 累計完了セッション数
- **完了率**: (完了セッション数 / 総セッション数) × 100%
- **平均集中時間**: 1セッションあたりの平均時間（分）
- **総集中時間**: 累計集中時間（分）

#### 3.2 アクティビティグラフ
- **期間**: 過去30日間
- **表示形式**: 棒グラフ
- **データ**: 日別の完了セッション数
- **日付表示**: MM-DD形式で主要な日付を表示

#### 3.3 週間比較（将来実装）
- 今週と先週の比較データ
- 完了数と集中時間の変化

## API仕様

### セッション管理

#### POST /api/session/start
新しいポモドーロセッションを開始

**リクエスト**:
```json
{
  "duration": 25
}
```

**レスポンス**:
```json
{
  "success": true,
  "session": {
    "id": 1,
    "user_id": 1,
    "duration_minutes": 25,
    "started_at": "2024-01-01T12:00:00",
    "completed": false
  }
}
```

#### POST /api/session/{session_id}/complete
セッションを完了

**レスポンス**:
```json
{
  "success": true,
  "session": {...},
  "user": {...},
  "leveled_up": true,
  "xp_earned": 50,
  "new_badges": [...]
}
```

#### GET /api/session/history?limit=10
セッション履歴を取得

### ゲーミフィケーション

#### GET /api/gamification/profile
ユーザープロフィールを取得

**レスポンス**:
```json
{
  "success": true,
  "profile": {
    "username": "default_user",
    "xp": 150,
    "level": 2,
    "current_streak": 3,
    "longest_streak": 5,
    "xp_for_next_level": 200,
    "xp_progress_percentage": 25.0
  }
}
```

#### GET /api/gamification/badges
バッジ情報を取得

**レスポンス**:
```json
{
  "success": true,
  "badges": {
    "earned": [...],
    "not_earned": [...],
    "total_earned": 2,
    "total_available": 6
  }
}
```

### 統計

#### GET /api/statistics
統計データを取得

#### GET /api/statistics/daily?days=30
日別アクティビティを取得

## UI/UX仕様

### カラースキーム
- **プライマリ**: #FF6B6B (赤系)
- **セカンダリ**: #4ECDC4 (青緑系)
- **成功**: #95E1D3 (緑系)
- **背景グラデーション**: #667eea → #764ba2 (紫系)

### レスポンシブデザイン
- **デスクトップ**: 2カラムレイアウト（タイマー + 情報パネル）
- **タブレット/モバイル**: 1カラムレイアウト（縦積み）

### アニメーション
- **プログレスリング**: 1秒ごとにスムーズに更新
- **XPバー**: 0.5秒のトランジション
- **モーダル**: スライドインアニメーション
- **ボタンホバー**: 上方向への移動とシャドウ効果

### アクセシビリティ
- キーボード操作対応
- 適切なコントラスト比
- セマンティックHTML
- スクリーンリーダー対応（将来実装）

## テスト仕様

### ユニットテスト
- **モデル**: 全データモデルのロジックテスト
- **サービス**: ビジネスロジックのテスト
- **リポジトリ**: データアクセスのテスト

### 統合テスト
- **API**: 全エンドポイントの動作テスト
- **シナリオ**: レベルアップ、バッジ獲得などのフロー

### カバレッジ目標
- **ユニットテスト**: 80%以上
- **統合テスト**: 主要フロー100%

## パフォーマンス要件

- **ページ読み込み**: 2秒以内
- **API応答時間**: 500ms以内
- **タイマー精度**: ±1秒以内
- **アニメーション**: 60fps維持

## ブラウザサポート

- **Chrome**: 最新版
- **Firefox**: 最新版
- **Safari**: 最新版
- **Edge**: 最新版

## 今後の機能拡張

### フェーズ2
1. カスタムタイマー設定
2. サウンド通知
3. 休憩タイマー（短休憩・長休憩）
4. ダークモード

### フェーズ3
1. マルチユーザー対応
2. ソーシャル機能（リーダーボード）
3. カレンダー連携
4. データエクスポート

### フェーズ4
1. モバイルアプリ
2. デスクトップアプリ
3. ブラウザ拡張機能
4. AI によるパーソナライズ
